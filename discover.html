<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Discover</title>

<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@500;700&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#8C00FF;
  --bg:#F2F2F2;
  --white:#fff;
  --text:#1F1F1F;
  --muted:#666;
  --radius:14px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text)}

.top-controls{
  position:sticky;top:0;z-index:10;
  background:#fff;padding:10px;
  display:flex;gap:10px;
  box-shadow:0 4px 12px rgba(0,0,0,.08)
}
.circle-btn{
  width:42px;height:42px;border-radius:50%;
  background:var(--primary);color:#fff;border:none
}
.search{
  flex:1;border:none;border-radius:999px;
  padding:0 16px;background:#EFEAF9
}

.style-selector{
  position:sticky;top:64px;z-index:9;
  background:#fff;padding:8px;
  display:flex;gap:7px;overflow-x:auto
}
.style-btn{
  min-width:30px;height:30px;border-radius:10px;
  border:1px solid #ddd;background:#fff
}
.style-btn.active{background:var(--primary);color:#fff}
.style-btn[disabled]{opacity:.4}

.grid{
  padding:12px;
  display:grid;
  gap:12px;
}

.card{
  background:#fff;border-radius:var(--radius);
  overflow:hidden;box-shadow:0 6px 16px rgba(0,0,0,.12);
  cursor:pointer
}
img{width:100%;object-fit:cover}

.title{
  font-family:'Rubik';font-weight:700;
  font-size:14px;line-height:1.3;
  display:-webkit-box;-webkit-line-clamp:2;
  -webkit-box-orient:vertical;overflow:hidden
}
.meta{
  font-size:12px;color:var(--muted);
  display:flex;gap:10px;flex-wrap:wrap
}

/* STYLE LAYOUTS */
.style-1{grid-template-columns:1fr}
.style-1 img{aspect-ratio:3/2}

.style-2{grid-template-columns:repeat(2,1fr)}
.style-2 img{aspect-ratio:2/3}
.style-2 .row{display:flex;justify-content:space-between}

.style-3{grid-template-columns:repeat(3,1fr)}
.style-3 img{aspect-ratio:2/3}
.style-3 .row{display:flex;justify-content:space-between;padding:6px}

.style-4{grid-template-columns:repeat(2,1fr)}
.style-4 img{aspect-ratio:3/2}
.style-4 .row{display:flex;justify-content:space-between}

.style-5{
  display:flex;gap:12px;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
}
.style-5::-webkit-scrollbar{display:none}
.style-5 .card{
  min-width:80%;
  scroll-snap-align:start;
  scroll-snap-stop:always;
}
.style-5 img{aspect-ratio:2/3}

.style-6 .card{display:flex}
.style-6 img{width:40%;aspect-ratio:3/2}
.style-6 .info{padding:10px;display:flex;flex-direction:column;gap:6px}

.style-7 .card{display:flex}
.style-7 img{width:35%;aspect-ratio:2/3}
.style-7 .info{padding:10px;display:flex;flex-direction:column;gap:6px}

.style-8 .media{display:flex;gap:8px}
.style-8 .poster{width:40%;aspect-ratio:2/3}
.style-8 .preview{
  width:60%;display:flex;
  overflow-x:auto;
  scroll-snap-type:x mandatory
}
.style-8 .preview::-webkit-scrollbar{display:none}
.style-8 .preview img{
  min-width:100%;
  aspect-ratio:3/2;
  scroll-snap-align:start;
  scroll-snap-stop:always;
}
.style-8 .info{padding:10px}

/* SCROLL BUFFER */
.scroll-spacer{height:1200px}
</style>
</head>

<body>

<div class="top-controls">
  <button class="circle-btn">â–¶</button>
  <input class="search" placeholder="Searchâ€¦" oninput="searchVideos(this.value)">
  <button class="circle-btn" onclick="shuffleVideos()">ğŸ²</button>
</div>

<div class="style-selector">
  <button class="style-btn active" onclick="setStyle(1)">1</button>
  <button class="style-btn" onclick="setStyle(2)">2</button>
  <button class="style-btn" onclick="setStyle(3)">3</button>
  <button class="style-btn" onclick="setStyle(4)">4</button>
  <button class="style-btn" onclick="setStyle(5)">5</button>
  <button class="style-btn" onclick="setStyle(6)">6</button>
  <button class="style-btn" onclick="setStyle(7)">7</button>
  <button class="style-btn" onclick="setStyle(8)">8</button>
  <button class="style-btn" disabled>9</button>
  <button class="style-btn" disabled>10</button>
</div>

<div id="grid" class="grid style-1"></div>
<div class="scroll-spacer"></div>

<script src="videocollection.js"></script>

<script>
let currentStyle=1;
let currentVideos=[...videoCollection];

/* =======================
   ONE-TIME FILTER (SESSION)
======================= */
(function applySessionFilter(){
  const raw=sessionStorage.getItem("discoverFilter");
  if(!raw) return;
  try{
    const f=JSON.parse(raw);
    currentVideos=currentVideos.filter(v=>{
      if(f.type==="tag") return Array.isArray(v.tags)&&v.tags.includes(f.value);
      if(f.type==="actress") return Array.isArray(v.actresses)&&v.actresses.includes(f.value);
      if(f.type==="series") return v.series===f.value;
      if(f.type==="studio") return v.studio===f.value;
      return true;
    });
  }catch(e){}
  sessionStorage.removeItem("discoverFilter");
})();

render();

function versionsText(v){
  return Array.isArray(v.versions)?v.versions.join(" "):"";
}

/* =======================
   RENDER
======================= */
function render(){
  const grid=document.getElementById("grid");
  grid.className=`grid style-${currentStyle}`;
  grid.innerHTML="";

  currentVideos.forEach(v=>{
    const c=document.createElement("div");
    c.className="card";
    c.onclick=()=>handleVideoClick(v);

    if(currentStyle===1){
      c.innerHTML=`
        <img src="${v.thumbnail}">
        <div class="info">
          <div class="title">${v.title}</div>
          <div class="meta">
            ğŸ†” ${v.code} ğŸ“… ${v.release} ğŸ•’ ${v.duration}m â­ ${v.rating} ${versionsText(v)}
          </div>
        </div>`;
    }

    if(currentStyle===2){
      c.innerHTML=`
        <img src="${v.poster}">
        <div class="info">
          <div class="title">${v.title}</div>
          <div class="row"><span>ğŸ†” ${v.code}</span><span>â­ ${v.rating}</span></div>
          <div class="row"><span>ğŸ•’ ${v.duration}m</span><span>${versionsText(v)}</span></div>
        </div>`;
    }

    if(currentStyle===3){
      c.innerHTML=`
        <img src="${v.poster}">
        <div class="row">
          <span>ğŸ†” ${v.code}</span><span>â­ ${v.rating}</span>
        </div>`;
    }

    if(currentStyle===4){
      c.innerHTML=`
        <img src="${v.thumbnail}">
        <div class="info">
          <div class="title">${v.title}</div>
          <div class="row"><span>ğŸ†” ${v.code}</span><span>â­ ${v.rating}</span></div>
          <div class="row"><span>ğŸ•’ ${v.duration}m</span><span>${versionsText(v)}</span></div>
        </div>`;
    }

    if(currentStyle===5){
      c.innerHTML=`
        <img src="${v.poster}">
        <div class="info">
          <div class="title">${v.title}</div>
          <div class="meta">
            ğŸ†” ${v.code} ğŸ“… ${v.release} ğŸ•’ ${v.duration}m â­ ${v.rating} ${versionsText(v)}
          </div>
        </div>`;
    }

    if(currentStyle===6){
      c.innerHTML=`
        <img src="${v.thumbnail}">
        <div class="info">
          <div>ğŸ†” ${v.code}</div>
          <div>ğŸ•’ ${v.duration}m</div>
          <div>â­ ${v.rating}</div>
        </div>`;
    }

    if(currentStyle===7){
      c.innerHTML=`
        <img src="${v.poster}">
        <div class="info">
          <div class="title">${v.title}</div>
          <div>ğŸ†” ${v.code}</div>
          <div>ğŸ“… ${v.release}</div>
          <div>ğŸ•’ ${v.duration}m</div>
          <div>${versionsText(v)}</div>
          <div>â­ ${v.rating}</div>
        </div>`;
    }

    if(currentStyle===8){
      c.innerHTML=`
        <div class="media">
          <img class="poster" src="${v.poster}">
          <div class="preview">
            <img src="${v.thumbnail}">
            <img src="${v.thumbnail}">
          </div>
        </div>
        <div class="info">
          <div class="title">${v.title}</div>
          <div class="meta">
            ğŸ†” ${v.code} ğŸ“… ${v.release} ğŸ•’ ${v.duration}m â­ ${v.rating} ${versionsText(v)}
          </div>
        </div>`;
    }

    grid.appendChild(c);
  });
}

/* =======================
   CONTROLS
======================= */
function setStyle(n){
  currentStyle=n;
  document.querySelectorAll(".style-btn").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
  render();
}
function shuffleVideos(){
  currentVideos.sort(()=>Math.random()-.5);
  render();
}
function searchVideos(q){
  q=q.toLowerCase();
  currentVideos=videoCollection.filter(v=>
    Object.values(v).join(" ").toLowerCase().includes(q)
  );
  render();
}

/* =======================
   GLOBAL MODAL HANDLER
======================= */
function handleVideoClick(video){
  if (window.parent && window.parent !== window &&
      typeof window.parent.openVideoModal === "function") {
    window.parent.openVideoModal(video);
    return;
  }
  try{
    sessionStorage.setItem("selectedVideo", JSON.stringify(video));
    window.open("modal.html", "_blank");
  }catch(e){}
}
</script>

</body>
</html>